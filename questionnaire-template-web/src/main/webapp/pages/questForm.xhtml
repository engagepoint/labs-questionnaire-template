<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:uib="http://engagepoint.com/uib" xmlns:F="http://java.sun.com/jsp/jstl/sql"

                template="/templates/template.xhtml">

    <style type="html/css">
        .ui-state-highlight {
            color: #00ff00;
        }
    </style>

    <f:metadata>
        <f:viewParam name="item" value="#{templateController.currentTemplateId}" />
    </f:metadata>

    <ui:define name="page">

        <h:form id="formTemplate">

            <p:panelGrid columns="1">

                <f:facet name="header">
                    <h:outputText value="Template" rendered="#{!templateController.isNew()}"/>
                    <h:outputText value="New template" rendered="#{templateController.isNew()}"/>
                </f:facet>

                <p:outputLabel for="name" value="Name:"/>
                <p:inputText id="name" required="true"
                             value="#{templateController.templateName}"/>


                <h:form id="form">

                    <p:growl id="messages" showDetail="true" escape="false"/>

                    <p:treeTable value="#{questFormTreeController.root}" var="node"
                                 selectionMode="single" selection="#{questFormTreeController.selectedNode}"
                                 id="treeMultiple">

                        <p:ajax event="select" update=":formTemplate:form:buttonPanel"/>
                        <p:ajax event="unselect" update=":formTemplate:form:buttonPanel"/>

                        <p:column>
                            <h:outputText value="#{node}"/>
                        </p:column>

                    </p:treeTable>

                    <p:panel id="buttonPanel">
                        <p:commandButton value="Add section"
                                         ajax="false"
                                         action="#{templateController.addSection}"
                                         styleClass="secondary"
                                         icon="ui-icon-add-v2"
                                         update="messages">
                            <f:setPropertyActionListener value="#{templateController.currentTemplate}"
                                                         target="#{questFormTreeController.templateBean}"/>
                        </p:commandButton>
                        <h:outputText value=" "/>
                        <p:commandButton value="Delete #{questFormTreeController.selectedType}"
                                         update="treeMultiple,buttonPanel"
                                         ajax="true"
                                         action="#{questFormTreeController.delete()}"
                                         rendered="#{questFormTreeController.haveSelected()}"
                                         id="btnDisplayDelete"
                                         styleClass="secondary"
                                         icon="ui-icon-remove"/>
                        <h:outputText value=" "/>
                        <p:commandButton value="#{questFormTreeController.editTitle}"
                                         rendered="#{questFormTreeController.haveSelected()}"
                                         action="#{questFormTreeController.edit()}"
                                         icon="#{questFormTreeController.editPicture}"
                                         styleClass="secondary"
                                         id="btnDisplayEdit"/>
                    </p:panel>


                </h:form>


                <f:facet name="footer">

                    <p:commandButton value="Save" id="save"
                                     action="#{templateController.saveTemplate}"/>
                    <h:outputText value=" "/>
                    <p:commandButton value="Cancel"
                                     id="cancel"
                                     update="modalDialogCancel"
                                     oncomplete="dlgCancel.show();"/>

                    <p:dialog id="modalDialogCancel" widgetVar="dlgCancel"
                              modal="true" height="100" closable="false" resizeable="false">
                        <h:outputFormat value="#{msgs.msgOnCancel}"/>
                        <br/>


                        <p:commandButton value="Yes"
                                         immediate="#{templateController.new}"
                                         action="#{listController.income}"
                                />
                        <p:commandButton value="No" id="no" onclick="dlgCancel.hide()"/>
                    </p:dialog>
                </f:facet>
            </p:panelGrid>

        </h:form>

    </ui:define>
</ui:composition>
